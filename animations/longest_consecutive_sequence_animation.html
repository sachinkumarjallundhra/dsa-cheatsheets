<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Longest Consecutive Sequence Animation</title>
    <style>
        :root {
            --color-bg-light: #f4f7f6; --color-bg-panel: #ffffff; --color-text-dark: #2c3e50;
            --color-primary: #3498db; --color-success: #2ecc71; --color-danger: #e74c3c;
            --color-warning: #f1c40f; --color-inactive: #ecf0f1;
            --color-sequence-bg: rgba(46, 204, 113, 0.2);
            --color-scanner: #9b59b6;
        }
        html, body {
            height: 100%; margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background-color: var(--color-bg-light);
        }
        .dashboard-container {
            display: grid; grid-template-columns: minmax(450px, 1fr) 2fr minmax(350px, 0.8fr);
            grid-template-rows: auto 1fr; grid-template-areas: "header header header" "left main right";
            gap: 15px; padding: 15px; height: 100%; box-sizing: border-box;
        }
        .panel { background-color: var(--color-bg-panel); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 15px; display: flex; flex-direction: column; min-height: 0; }
        h1, h2 { color: var(--color-text-dark); text-align: center; margin-top: 0; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #eee;}
        h1 { font-size: 1.5em; border: none; } h2 { font-size: 1.1em; }

        .header { grid-area: header; }
        .controls { display: flex; flex-wrap: wrap; gap: 15px; padding: 10px; background-color: #eaf5fb; border-radius: 5px; align-items: center; justify-content: center;}
        .controls textarea { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: 'Courier New', monospace; width: 500px; height: 50px; resize: vertical; }
        .controls button { padding: 10px 15px; background-color: var(--color-primary); color: white; border: none; border-radius: 4px; cursor: pointer; }
        .controls button:disabled { background-color: #bdc3c7; }

        .left-column { grid-area: left; display: flex; flex-direction: column; gap: 15px; min-height: 0; }
        .main-column { grid-area: main; display: flex; flex-direction: column; min-height: 0; }
        .right-column { grid-area: right; display: flex; flex-direction: column; gap: 15px; min-height: 0; }
        
        #code_container { background: #2d2d2d; color: #f1f1f1; font-family: 'Courier New', monospace; font-size: 0.8em; flex-shrink: 1; overflow-y: auto;}
        .code-line { padding: 2px 5px; border-radius: 3px; transition: background-color 0.3s; }
        .code-line.highlight { background-color: #555; }
        #action_display { text-align: center; font-weight: bold; font-size: 1.1em; background: #f8f9fa; padding: 8px; border-radius: 4px; }
        
        #number_line_container { position: relative; width: 100%; flex-grow: 1; display: flex; align-items: center; justify-content: flex-start; background: #fafafa; border-radius: 5px; border: 1px solid #e0e0e0; overflow-x: auto; padding: 0 20px; box-sizing: border-box;}
        #number_line_wrapper { display: flex; position: relative; padding: 40px 0; }
        .number-block { flex-shrink: 0; display: flex; justify-content: center; align-items: center; width: 40px; height: 40px; margin: 0 5px; border: 2px solid; border-radius: 5px; font-weight: bold; transition: all 0.3s ease; }
        .number-block.in-set { background-color: var(--color-primary); border-color: #2980b9; color: white; }
        .scanner-arrow { position: absolute; bottom: 10px; width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid var(--color-scanner); transition: left 0.3s ease; }
        .check-marker { position: absolute; top: 0px; font-size: 30px; font-weight: bold; transition: left 0.3s ease; }
        .sequence-highlight { position: absolute; top: 50%; transform: translateY(-50%); height: 50px; background-color: var(--color-sequence-bg); border-left: 3px solid var(--color-success); border-right: 3px solid var(--color-success); border-radius: 8px; transition: all 0.3s ease; }
        
        .data-container { overflow-y: auto; padding: 10px; background: #fafafa; border-radius: 4px; min-height: 0; }
        .variable-display { text-align: center; font-size: 1.5em; margin-bottom: 20px; }
        .variable-display .label { font-size: 0.7em; color: var(--color-text-dark); display: block; }
        .variable-display .value { font-weight: bold; color: var(--color-primary); }
        .variable-display .value.flash { animation: flash 0.5s ease; }
        @keyframes flash { 50% { color: var(--color-warning); transform: scale(1.2); } }
        #set_contents { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
        .set-item { background-color: #d6eaf8; color: #2980b9; padding: 3px 6px; border-radius: 4px; font-family: 'Courier New', monospace;}

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; }
        #final_result_text { font-size: 1.8em; font-weight: bold; margin: 20px 0; color: var(--color-primary); }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header panel">
            <h1>Longest Consecutive Sequence</h1>
            <div class="controls">
                <label>Numbers [100, 4, ...]:</label><textarea id="nums_input">[100, 4, 200, 1, 3, 2, 101, 102]</textarea>
                <button id="start_button">Start</button>
                <button id="next_step_button" disabled>Next Step</button>
            </div>
        </header>

        <div class="left-column">
            <div class="panel">
                <h2>Algorithm</h2>
                <div id="code_container"></div>
            </div>
            <div class="panel" style="flex-grow: 0; flex-shrink: 0;">
                <h2>Current Action</h2>
                <div id="action_display">Enter numbers and click 'Start'.</div>
            </div>
        </div>

        <main class="main-column panel">
            <h2>Visualization</h2>
            <div id="number_line_container"></div>
        </main>

        <div class="right-column">
             <div class="panel">
                <h2>State Variables</h2>
                <div class="data-container">
                    <div class="variable-display">
                        <span class="label">Max Length</span>
                        <span id="max_len_val" class="value">0</span>
                    </div>
                    <div class="variable-display">
                        <span class="label">Current Length</span>
                        <span id="current_len_val" class="value">0</span>
                    </div>
                </div>
             </div>
             <div class="panel">
                <h2>HashSet Contents</h2>
                <div id="set_contents" class="data-container"></div>
            </div>
        </div>
    </div>

    <div id="result_modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Final Result</h2>
            <p id="final_result_text"></p>
            <button id="modal_close_btn" class="controls button">Close</button>
        </div>
    </div>

<script>
let animationSteps = [], currentStepIndex = 0, simulationRunning = false;
let numsInput, startButton, nextStepButton, codeContainer, actionDisplay, numberLineContainer,
    maxLenVal, currentLenVal, setContents, resultModal, finalResultText, modalCloseBtn, numberLineDrawer;

class NumberLineDrawer {
    constructor(container, nums) {
        this.container = container;
        this.sortedUniqueNums = [...new Set(nums)].sort((a,b) => a - b);
        this.numberBlocks = {};
    }

    draw(state) {
        this.container.innerHTML = '';
        const wrapper = document.createElement('div');
        wrapper.id = 'number_line_wrapper';
        
        this.sortedUniqueNums.forEach(num => {
            const block = document.createElement('div');
            block.textContent = num;
            block.classList.add('number-block');
            block.classList.toggle('in-set', state.set_contents.includes(num));
            wrapper.appendChild(block);
            this.numberBlocks[num] = block;
        });
        this.container.appendChild(wrapper);

        const { scanner_pos, check_pos, check_result, sequence_start, sequence_end } = state.highlights;

        if (scanner_pos !== null && this.numberBlocks[scanner_pos]) {
            const block = this.numberBlocks[scanner_pos];
            const arrow = document.createElement('div');
            arrow.classList.add('scanner-arrow');
            arrow.style.left = `${block.offsetLeft + block.offsetWidth / 2 - 10}px`;
            wrapper.appendChild(arrow);
        }
        
        if (check_pos !== null) {
            const marker = document.createElement('div');
            marker.classList.add('check-marker');
            if (check_result === 'found') {
                marker.textContent = '❌'; marker.style.color = 'var(--color-danger)';
            } else {
                marker.textContent = '✔️'; marker.style.color = 'var(--color-success)';
            }
            
            const currentBlock = this.numberBlocks[check_pos + 1];
            const prevBlock = this.numberBlocks[check_pos];
            let markerLeft;
            if (prevBlock) { // If num-1 exists, place marker over it
                markerLeft = prevBlock.offsetLeft + prevBlock.offsetWidth / 2 - 15;
            } else if (currentBlock) { // If num-1 doesn't exist, place in gap to the left of current
                markerLeft = currentBlock.offsetLeft - 30;
            }
            if (markerLeft !== undefined) {
                marker.style.left = `${markerLeft}px`;
                wrapper.appendChild(marker);
            }
        }

        if (sequence_start !== null && this.numberBlocks[sequence_start] && this.numberBlocks[sequence_end]) {
            const startBlock = this.numberBlocks[sequence_start];
            const endBlock = this.numberBlocks[sequence_end];
            const highlight = document.createElement('div');
            highlight.classList.add('sequence-highlight');
            highlight.style.left = `${startBlock.offsetLeft}px`;
            highlight.style.width = `${endBlock.offsetLeft + endBlock.offsetWidth - startBlock.offsetLeft}px`;
            wrapper.appendChild(highlight);
        }
    }
}

class Animation {
    constructor() { this.reset(); }
    reset() {
        animationSteps = []; currentStepIndex = 0; simulationRunning = false;
        this.updateButtons(); this.clearDisplays(); resultModal.style.display = 'none';
    }
    clearDisplays() {
        if (!codeContainer) return;
        [codeContainer, numberLineContainer, setContents].forEach(c => c.innerHTML = '');
        maxLenVal.textContent = '0'; currentLenVal.textContent = '0';
        actionDisplay.textContent = 'Enter numbers and click \'Start\'.';
    }
    start() {
        this.reset();
        try {
            const nums = JSON.parse(numsInput.value.trim().replace(/'/g, '"'));
            if (!Array.isArray(nums)) throw new Error("Invalid input format.");
            
            this.initUI();
            numberLineDrawer = new NumberLineDrawer(document.getElementById('number_line_container'), nums);
            animationSteps = this.generateSteps(nums);
            
            simulationRunning = true;
            if (animationSteps.length > 0) this.renderState(animationSteps[0]);
            this.updateButtons();
        } catch(e) { console.error(e); alert("Invalid input. Please use JSON array format. Error: " + e.message); }
    }
    next() {
        if (!simulationRunning || currentStepIndex >= animationSteps.length - 1) return;
        currentStepIndex++; this.renderState(animationSteps[currentStepIndex]); this.updateButtons();
    }
    updateButtons() {
        startButton.textContent = simulationRunning ? "Reset" : "Start";
        nextStepButton.disabled = !simulationRunning || currentStepIndex >= animationSteps.length - 1;
    }
    
    initUI() {
        const code = [
            "set = new HashSet(nums)",
            "max_len = 0",
            "for num in set:",
            "  if (num - 1) not in set:",
            "    // Found a sequence start",
            "    curr_len = 1",
            "    curr_num = num",
            "    while (curr_num + 1) in set:",
            "      curr_num++",
            "      curr_len++",
            "    max_len = max(max_len, curr_len)",
            "return max_len"
        ];
        codeContainer.innerHTML = code.map((line, i) => `<div class="code-line" id="code-line-${i}">${line.replace(/ /g, '&nbsp;')}</div>`).join('');
    }

    generateSteps(nums) {
        const steps = []; const save = (data) => steps.push(JSON.parse(JSON.stringify(data)));
        let state = {
            line: null, msg: "", set_contents: [], max_len: 0, current_len: 0,
            highlights: { scanner_pos: null, check_pos: null, check_result: null, sequence_start: null, sequence_end: null },
            result: null
        };

        save({ ...state, line: 0, msg: "Create a HashSet for O(1) lookups." });
        const numSet = new Set();
        for (const num of nums) {
            if (!numSet.has(num)) {
                numSet.add(num);
                state.set_contents = Array.from(numSet).sort((a,b)=>a-b);
                save({ ...state, msg: `Adding ${num} to the set.` });
            }
        }
        
        save({ ...state, line: 1, msg: "Initialize max_len to 0." });
        const sortedUniqueNums = Array.from(numSet).sort((a,b) => a-b);
        
        for (const num of sortedUniqueNums) {
            state.highlights = { ...state.highlights, scanner_pos: num, check_pos: null, check_result: null, sequence_start: null, sequence_end: null };
            save({ ...state, line: 2, msg: `Checking number ${num}.` });
            
            state.highlights.check_pos = num - 1;
            const isStart = !numSet.has(num - 1);
            state.highlights.check_result = isStart ? 'not_found' : 'found';
            save({ ...state, line: 3, msg: `Is ${num - 1} in the set? ${isStart ? 'No.' : 'Yes.'}` });

            if (isStart) {
                save({ ...state, line: 4, msg: `${num} is the start of a new sequence!` });
                state.current_len = 1;
                state.highlights.sequence_start = num; state.highlights.sequence_end = num;
                save({ ...state, line: 5, msg: `Start building sequence. Current length: ${state.current_len}.` });
                
                let curr_num = num;
                while (numSet.has(curr_num + 1)) {
                    save({ ...state, line: 7, msg: `Checking if ${curr_num + 1} is in the set... Yes.` });
                    curr_num++;
                    state.current_len++;
                    state.highlights.sequence_end = curr_num;
                    save({ ...state, line: 9, msg: `Extending sequence. Current length: ${state.current_len}.` });
                }
                save({ ...state, line: 7, msg: `Checking if ${curr_num + 1} is in the set... No.` });
                
                if (state.current_len > state.max_len) {
                    state.max_len = state.current_len;
                    save({ ...state, line: 10, msg: `Sequence ended. New max length found: ${state.max_len}!` });
                } else {
                    save({ ...state, line: 10, msg: `Sequence ended. Max length remains ${state.max_len}.` });
                }
                state.current_len = 0;
            } else {
                save({ ...state, line: 3, msg: `${num} is not a start, skip.` });
            }
        }
        state.highlights = { scanner_pos: null, check_pos: null, check_result: null, sequence_start: null, sequence_end: null };
        state.result = state.max_len;
        save({ ...state, line: 11, msg: `Finished checking all numbers. Final result: ${state.max_len}.` });
        return steps;
    }
    
    renderState(state) {
        actionDisplay.innerHTML = state.msg;
        document.querySelectorAll('.code-line').forEach(el => el.classList.remove('highlight'));
        if (state.line !== null) document.getElementById(`code-line-${state.line}`)?.classList.add('highlight');
        if(numberLineDrawer) numberLineDrawer.draw(state);

        if (maxLenVal.textContent !== String(state.max_len)) {
            maxLenVal.classList.add('flash');
            setTimeout(() => maxLenVal.classList.remove('flash'), 500);
        }
        maxLenVal.textContent = state.max_len;
        currentLenVal.textContent = state.current_len;

        setContents.innerHTML = state.set_contents.map(n => `<div class="set-item">${n}</div>`).join('');
        
        if (state.result !== null) {
            finalResultText.textContent = `Longest Sequence is ${state.result}`;
            resultModal.style.display = 'flex';
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    numsInput = document.getElementById('nums_input');
    startButton = document.getElementById('start_button'); nextStepButton = document.getElementById('next_step_button');
    codeContainer = document.getElementById('code_container'); actionDisplay = document.getElementById('action_display');
    numberLineContainer = document.getElementById('number_line_container'); 
    maxLenVal = document.getElementById('max_len_val'); currentLenVal = document.getElementById('current_len_val');
    setContents = document.getElementById('set_contents');
    resultModal = document.getElementById('result_modal'); finalResultText = document.getElementById('final_result_text');
    modalCloseBtn = document.getElementById('modal_close_btn');
    
    const anim = new Animation();
    startButton.addEventListener('click', () => { if(simulationRunning) anim.reset(); else anim.start(); });
    nextStepButton.addEventListener('click', () => anim.next());
    modalCloseBtn.addEventListener('click', () => resultModal.style.display = 'none');
    resultModal.addEventListener('click', (e) => { if (e.target === resultModal) resultModal.style.display = 'none'; });
});
</script>
</body>
</html>